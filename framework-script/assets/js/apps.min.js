/*! ** coddy.com.mx - Base v1.1.0 */
//  ** Última modificación: '10-07-2023';

// Usamos el modo estricto de javascript para evitar errores en el código javascript de la página web (use strict)
'use strict';

// Custom event for ready framework-script
(function() {
  // Variable de la URL para obtener la URL según ambiente.
  var ROOT = 'http://localhost:8888/';

  // Rutas de los archivos
  // Ruta de los archivos assets
  var ASSETS_PATH = ROOT + 'assets/';
  // Ruta de los archivos de scripts
  var SCRIPTS_PATH = ASSETS_PATH + 'js/';
  // Ruta de las librerías
  var LIBS_PATH = ROOT + 'lib/';
  // Ruta de los componentes
  var COMPONENTS_PATH = ROOT + 'components/';
  // Ruta de los componentes scripts
  var COMPONENTS_SCRIPTS_PATH = COMPONENTS_PATH + 'js/';

  // Scripts a cargar en la página web (scriptsToLoad)
  var scriptsToLoad = [
    // 'vendor/pace.min.js',
    'main.min.js',
    'custom.min.js'
  ];
  // Componentes a cargar en la página web (componentsToLoad)
  var scriptComponents = [
    'structures.min.js'
  ];

  // Crea el elemento del loader
  var loader = document.createElement('div');
  loader.id = 'loader';
  var spinner = document.createElement('div');
  spinner.id = 'loader-spinner';
  // Agrega el spinner al loader
  loader.appendChild(spinner);
  // Agrega el loader al body
  document.body.appendChild(loader);

  // Cargamos los scripts de la página web de forma síncrona
  function loadScript(index) {
    if (index >= scriptsToLoad.length) {
      // Todos los scripts se han cargado
      // Disparar el evento personalizado "framework-script-ready"
      var udcFrameworkReadyEvent = new CustomEvent('framework-script-ready');
      document.dispatchEvent(udcFrameworkReadyEvent);
      return;
    }

    var script = scriptsToLoad[index];
    var scriptElement = document.createElement('script');
    scriptElement.type = 'text/javascript';
    scriptElement.src = SCRIPTS_PATH + script;
    scriptElement.onload = function() {
      // Cargar el siguiente script
      loadScript(index + 1);
    };
    document.head.appendChild(scriptElement);
  }

  // Cargamos los componentes de la página web de forma síncrona
  function loadComponent(index) {
    if (index >= scriptComponents.length) {
      // Todos los componentes se han cargado
      return;
    }

    var script = scriptComponents[index];
    var scriptElement = document.createElement('script');
    scriptElement.type = 'text/javascript';
    scriptElement.src = COMPONENTS_SCRIPTS_PATH + script;
    scriptElement.onload = function() {
      // Cargar el siguiente componente
      loadComponent(index + 1);
    }
    document.head.appendChild(scriptElement);
  }

  // Cargar el primer script
  loadScript(0);
  // Cargar el primer componente
  loadComponent(0);

  // Cargamos el script de bootstrap de forma asíncrona
  var bs = document.createElement('script');
  bs.type = 'text/javascript';
  bs.src = LIBS_PATH + 'bootstrap/5.3.0/js/bootstrap.bundle.min.js';
  var firstScript = document.getElementsByTagName('script')[0];
  document.head.insertBefore(bs, firstScript);

  // Oculta el loader una vez que se haya cargado todo
  window.addEventListener('load', function() {
    // Obtén la referencia del loader
    var loader = document.getElementById('loader');
    // Oculta el loader
    loader.style.display = 'none';
    document.body.classList.add('coddy-loaded');
  });

  // Esperar al evento 'DOMContentLoaded' para asegurarse de que todo el DOM esté cargado
  document.addEventListener('DOMContentLoaded', function() {
    // Obtén la referencia del slot de scripts
    var scriptsSlot = document.querySelector('slot[name="scripts"]');
    if (scriptsSlot) {
      // Esperar a que se asignen los nodos al slot
      scriptsSlot.addEventListener('slotchange', function() {
        // Obtén los nodos de script dentro del slot
        var scriptNodes = scriptsSlot.assignedNodes();
        // Cargar cada script asincrónicamente
        scriptNodes.forEach(function(scriptNode) {
          if (scriptNode.tagName === 'SCRIPT') {
            var scriptElement = document.createElement('script');
            scriptElement.type = 'text/javascript';
            scriptElement.innerHTML = scriptNode.innerHTML;
            document.head.appendChild(scriptElement);
          }
        });
      });
    }
  });
})();
