/*! ** coddy.com.mx - Base v1.1.0 */
//  ** Última modificación: '10-07-2023';

var CODDY = CODDY || {};
// Variable de la URL para obtener la URl segun ambiente.
CODDY.root ='http://localhost:8888/';

// Rutas de los archivos
// Rura de los archivos assets
CODDY.path = CODDY.root + 'assets/';
// Ruta de los archivos de imagenes
CODDY.imagesPath = CODDY.path + 'img/';
// Ruta de los archivos de scripts
CODDY.scriptsPath = CODDY.path + 'js/';
// Ruta de los archivos de estilos
CODDY.stylesPath = CODDY.path + 'css/';
// Ruta de los archivos de librerias
CODDY.libsPath = CODDY.root + 'lib/';

// Variables de la plantilla
var SITE_METADATA_TITLE = 'FrameworkScript',
    // Variables que se reciben de la pagina web para construir la plantilla (SITE_* | PAGE_* | NAVBAR_* | SECTION_*)
    // Variable para obtener el template del sitio (undefined = DEFAULT para APPS | 1 = plantillas de sistemas internos)
    SITE_TEMPLATE, // undefined | 1
    // Variable para obtener el menu del sitio a traves de un array de objetos
    SITE_MENU, // array
    // Variable para obtener el sidebar del sitio a traves de un array de objetos
    SITE_SIDEBAR, // array
    // Variable para obtener el titulo del sitio (string)
    SITE_TITLE, // string
    // Variable para obtener el logo del sitio (string | url de la imagen que se debe cargar en el header de la pagina)
    SITE_LOGO, // string | url
    // Variable para obtener el logo secundario para colocar del lado derecho de la cabecera del sitio (string | url de la imagen que se debe cargar en el header de la pagina)
    SECONDARY_LOGO, // string | url
    // Variable para obtener el titulo de la pagina 
    PAGE_TITLE, // string
    // Variable para obtener la descripcion de la pagina
    PAGE_DESCRIPTION, // string
    // Variable para obtener un array de objetos para construir el breadcrumb de navegacion de la pagina
    BREADCRUMB_SITE, // array
    // Variable para obtener un array de objetos para construir el breadcrumb de sesion de la pagina
    BREADCRUMB_SESSION, // array
    // Variable para definir el modo de la pagina (container o container-fluid) | default: container-fluid
    CONTAINER_MODE, // container | default: container-fluid
    // Definimos si nuestra pagina web tendrá espacio superior (true) | default: false
    SECTION_SUPERIOR, // false
    // Definimos si nuestra pagina web tendrá espacio inferior (true) | default: false
    SECTION_SUPERIOR, // false 
    // Revisamos si existe una variable para cargar los componentes de VUE
    IMPORT_COMPONENTS, // array

    // Bandera para saber si existe una variable title en la pagina web
    LOAD_TITLE = '',
    // Bandera para saber si existe una variable CODDY en la pagina web
    TEXT_CODDY = '';

    SECONDARY_LOGO = window.SECONDARY_LOGO || '';
    // Cargar titulo
    TEXT_CODDY = SITE_METADATA_TITLE;
    // Cargamos el titulo de la pagina web si existe | por default es "FrameworkScript
    LOAD_TITLE = window.SITE_TITLE || SITE_METADATA_TITLE; 
    // Si es verdadero se muestra el espacio superior de la pagina web (SECTION_SUPERIOR) | por default es falso
    SECTION_SUPERIOR = window.SECTION_SUPERIOR || false;
    // Si trae un array de objetos se carga el menu de la pagina web (SITE_MENU) | por default es un array vacio
    SITE_MENU = window.SITE_MENU || [];
    // Si trae un array de objetos se carga el sidebar de la pagina web (SITE_SIDEBAR) | por default es un array vacio
    SITE_SIDEBAR = window.SITE_SIDEBAR || [];
    // Si trae un array de objetos se carga el breadcrumb de la pagina web (BREADCRUMB_SITE) | por default es un array vacio
    BREADCRUMB_SITE = window.BREADCRUMB_SITE || [];
    // Si trae un array de objetos se carga el breadcrumb de sesion de la pagina web (BREADCRUMB_SESSION) | por default es un array vacio
    BREADCRUMB_SESSION = window.BREADCRUMB_SESSION || [];
    // Si trae un array de objetos se carga los componentes de VUE de la pagina web (IMPORT_COMPONENTS) | por default es un array vacio
    IMPORT_COMPONENTS = window.IMPORT_COMPONENTS || [];

    // Iniciar proceso de construcción de la plantilla
    CODDY.secBuilder = function () {
        // Obtenemos el body de la página web
        var body = document.body;
        // Obtenemos el head de la página web
        var head = document.head;
        // Indicamos el año del copyRight de la página web
        var copyRightYear = 2023;
        // Indicamos el copyRight de la página web
        var copyRight = `&copy; ${copyRightYear} ${SITE_METADATA_TITLE}`;

        // Indicamos los metadatos de la página web (metaData)
        var metaData = `
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <title>${LOAD_TITLE != '' && LOAD_TITLE != SITE_METADATA_TITLE ? LOAD_TITLE + ' | ' : ''} ${SITE_METADATA_TITLE}</title>
            <link rel="image_src" href="${CODDY.imagesPath}favicon.ico"/>
            <link rel="icon" href="${CODDY.imagesPath}favicon.ico" type="image/x-icon"/>
            <link rel="apple-touch-icon" href="${CODDY.imagesPath}favicon.ico">
            <link href="${CODDY.libsPath}bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
            ${SITE_TEMPLATE === 1 ? `<link href="${CODDY.stylesPath}templates/${SITE_TEMPLATE}.css" rel="stylesheet">` : ``}
        `;
        // Agregamos los metadatos al head de la página web
        head.innerHTML = metaData + head.innerHTML
        // Template header de la página web (header) | el header es el encabezado de la página web que contiene el logo de la universidad y el menu de navegación de la página web
        var navBar = ``;
        var headerElement = document.querySelector('b-header');
        if (headerElement === null) {
            navBar = `<b-header site-title="FrameworkScript" site-logo="logo-2" title-show="none" text-color="#FFFFFF" bg-color="#444444" container-size="fluid">
                            <slot slot="menu"></slot>
                        </b-header>`;
        } else {
            navBar = headerElement.outerHTML;
            headerElement.parentNode.removeChild(headerElement);
        }

        var content = ``;
        var contentElement = document.querySelector('b-content');
        if (contentElement === null) {
            content = `<b-content>
                            <slot slot="content"></slot>
                        </b-content>`;
        } else {
            content = contentElement.outerHTML;
            contentElement.parentNode.removeChild(contentElement);
        }


        var section_title = `${SECTION_SUPERIOR ? `<div class="bg-lime border-bottom ${BREADCRUMB_SITE ? `pb-3` : `py-4`}">
                                                        <div class="${CONTAINER_MODE == undefined ? 'container-fluid' : CONTAINER_MODE} small">
                                                            <div class="row small">
                                                                <div class="col-12 col-md-6">
                                                                    ${BREADCRUMB_SITE ? `<ol class="breadcrumb breadcrumb-nav mb-0 py-2"></ol>` : ``}  
                                                                </div>
                                                                <div class="col-12 col-md-6" style="--bs-breadcrumb-divider: '|';">
                                                                    ${BREADCRUMB_SESSION ? ` <ol class="breadcrumb breadcrumb-session mb-0 py-2 justify-content-end"></ol>` : ``}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="${CONTAINER_MODE == undefined ? 'container-fluid' : CONTAINER_MODE} position-relative">
                                                            ${PAGE_TITLE ? `<h1 class="h4 text-center text-uppercase mb-0">${PAGE_TITLE}</h1>` : ``}
                                                            ${PAGE_DESCRIPTION ? `<p class="text-center mx-0 mx-md-5 mb-0">${PAGE_DESCRIPTION}</p>` : ``}
                                                        </div>
                                                    </div>` : ``}`;

        // Template footer de la página web (footer) | el footer es el pie de página de la página web
        var footer = ``;
        var footerElement = document.querySelector('b-footer');
        if (footerElement === null) {
            footer = `<b-footer site-title="FrameworkScript" site-logo="logo-2" title-show="none" text-color="#FFFFFF" bg-color="#444444" container-size="fluid">
                            <slot slot="footer"></slot>
                        </b-footer>`;
        } else {
            footer = footerElement.outerHTML;
            footerElement.parentNode.removeChild(footerElement);
        }

        // Creamos el elemento header de la página web
        var navBarApp = document.createElement('header');
        // Creamos el elemento section para el titulo de la página web
        var sectionTitleApp = document.createElement('section');
        sectionTitleApp.className = 'section-title';
        var contentApp = document.createElement('main');
        // Creamos el elemento footer de la página web
        var footerApp = document.createElement('footer');
        // Agregamos el contenido de la plantilla al header de la página web
        navBarApp.innerHTML = navBar;
        // Agregamos el contenido de la plantilla al section de la página web
        sectionTitleApp.innerHTML = section_title;
        // Agregamos el contenido de la plantilla al main de la página web
        contentApp.innerHTML = content;
        // Agregamos el contenido de la plantilla al footer de la página web
        footerApp.innerHTML = footer;

        // Para cargar los elementos con prepend se debe de invertir el orden de los elementos (estos se cargan al inicio del body)
        // Insetamos el footer de la página web
        body.prepend(footerApp);

        // Insetamos el main de la página web
        body.prepend(contentApp);

        // Insetamos el titulo de la página web
        body.prepend(sectionTitleApp);

        // Insetamos el header de la página web
        body.prepend(navBarApp);        
    };

    (function(){
        // Se ejecuta la funcion de construcción de la plantilla
        CODDY.secBuilder();
    })();
